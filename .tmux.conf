# Tmux configuration file
# Reading materials
#   https://wiki.archlinux.org/index.php/Tmux
#   https://danielmiessler.com/study/tmux/
# PROPERTIES ##################################################################
set-option escape-time 10
set-option -g history-limit 5000
set-option -g display-panes-time 5000
set-option -g mode-keys vi
set-option -g status-keys vi
set-option -g renumber-windows on
set-option -g base-index 1                  # Start window numbering at 1
set-option -g pane-base-index 1             # Start pane numbering at 1
set-option -g clock-mode-style 24           # 24h clocks
set-window-option -g allow-rename off

# Enable truecolor if the terminal supports it
if-shell 'echo $TERM | grep 256color' 'set-option -g default-terminal tmux-256color'

# VISUALS #####################################################################
# RUINER colourscheme
# COLOUR1='#dc122a'
# COLOUR2='#750005'
# COLOUR3='#000000'

# Mountains on Mars colourscheme
# COLOUR1='#ea1646'
# COLOUR2='#870d2c'
# COLOUR3='#170420'

# Bookmark colourscheme
# COLOUR1='#9c1513'
# COLOUR2='#2f0807'
# COLOUR3='#000c12'

# Red Star colourscheme
COLOUR1='#ed1c24'
COLOUR2='#793533'
COLOUR3='#1d1d1d'

# Other colours
COLOUR4='#dddddd'

set-option -g window-status-format '#I:#W'
set-option -g window-status-current-format '#I:#W'
set-option -g status-left '[#S]#{?window_zoomed_flag,[Z],[]=} '
set-option -g status-right '%a, %Y-%m-%d - %H:%M'
set-option -g status-justify left
set-option -g pane-border-status top        # Enable pane status bar on the top
set-option -g pane-border-format '#P:#{pane_current_command}'

# Set colourscheme if the terminal supports truecolor
if-shell 'echo $TERM | grep 256color' '\
    set-option -g window-status-current-style "fg=$COLOUR4,bg=$COLOUR1";\
    set-option -g status-style "fg=$COLOUR3,bg=$COLOUR1";\
    set-option -g pane-border-style "fg=$COLOUR2",bg=$COLOUR3;\
    set-option -g pane-active-border-style "fg=$COLOUR1,bg=$COLOUR3";\
    set-option -g clock-mode-colour "$COLOUR1";\
    set-option -g display-panes-active-colour "$COLOUR1";\
    set-option -g display-panes-colour "$COLOUR2";\
    set-option -g mode-style "fg=$COLOUR3,bg=$COLOUR1"'

# KEY BINDINGS ################################################################
# Remap prefix from 'Ctrl+b' to 'Alt+space'
unbind-key 'C-b'
set-option -g prefix 'M-space'
bind-key 'r' source-file ~/.tmux.conf       # Reload configuration
bind-key -n 'M-n' display-panes             # Display pane numbering

# Pane splitting
bind-key -n 'M-/' split-window -h
bind-key -n 'M--' split-window -v
unbind-key '"'
unbind-key '%'

# Pane navigation - Alt + h|j|k|l (no rollover at edges)
bind-key -n 'M-h' if-shell -F '#{pane_at_left}' '' 'select-pane -L'
bind-key -n 'M-j' if-shell -F '#{pane_at_bottom}' '' 'select-pane -D'
bind-key -n 'M-k' if-shell -F '#{pane_at_top}' '' 'select-pane -U'
bind-key -n 'M-l' if-shell -F '#{pane_at_right}' '' 'select-pane -R'

# Alt + Shift + j|k to shift pane Down or Up the list
bind-key -n 'M-J' swap-pane -D
bind-key -n 'M-K' swap-pane -U

# Alt + n|p to go to the next|previous window (no rollover at edges)
bind-key -n 'M-n' if-shell -F '#{window_end_flag}' '' 'next-window'
bind-key -n 'M-p' if-shell -F '#{window_start_flag}' '' 'previous-window'

# Alt + Tab to cycle to the last window
bind-key -n 'M-Tab' last-window

# Alt + z to toggle pane zoom
bind-key -n 'M-m' resize-pane -Z

# Send copy-mode selection to both primary and clipboard - Source:
#   https://www.freecodecamp.org/news/tmux-in-practice-integration-with-system-clipboard-bcd72c62ff7b/
bind -T copy-mode-vi 'Enter' send-keys -X copy-pipe-and-cancel "xclip -i -f -selection primary | xclip -i -selection clipboard"

# THINGS THAT I ALWAYS FORGET #################################################
## Customize options        <prefix>, S
## Display keybindings:     <prefix>, '?'
## Toggle pane zoom:        <prefix>, 'z'
## Copy Mode:               <prefix>, '[' or 'Alt' + 'v'
## Start text selection:    'space'       (in Copy Mode)
## Copy selection:          'Enter'       (after text selection in Copy Mode)
## Rename session:          <prefix>, '$'
## Rename window:           <prefix>, ','
## List sessions:           <prefix>, 's'
## Resize pane:             <prefix>, 'Alt|Shift' + 'up|down|left|right'
## Create new window:       <prefix>, 'c'
## Go to previous window:   <prefix>, 'p' or 'Alt' + 'p'
## Go to next window:       <prefix>, 'n' or 'Alt' + 'n'
## Go to window number N:   <prefix>, N
## Move current window:     <prefix>, '.'
## Spread panes evenly:     <prefix>, 'E'
